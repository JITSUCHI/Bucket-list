<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BucketList 詳細</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI",sans-serif;background:#f4f6f8;color:#333}
    header{background:#fff;border-bottom:1px solid #ddd;padding:12px 16px;display:flex;align-items:center}
    .btn{background:#e9ecf2;border:1px solid #ccc;border-radius:6px;padding:6px 12px;cursor:pointer}
    main{padding:16px;max-width:800px;margin:0 auto}
    textarea{width:100%;min-height:200px;font-family:monospace}
    input,select,textarea{margin-top:8px;margin-bottom:16px;font-size:14px;padding:6px;width:100%}
    label{font-weight:600;display:block;margin-top:12px}
  </style>
</head>
<body>
  <header>
    <button id="backBtn" class="btn">← 戻る</button>
    <h1 style="margin-left:12px;font-size:18px">詳細ページ</h1>
  </header>
  <main>
    <label>タイトル<input id="titleInput" type="text"></label>
    <label>ステータス
      <select id="statusSelect"></select>
    </label>
    <label>期限
      <select id="deadlineSelect"></select>
    </label>
    <label>詳細メモ (Markdownで入力可)
      <textarea id="noteArea"></textarea>
    </label>
    <button id="saveBtn" class="btn">保存</button>
  </main>

  <script>
    const GENRES=["旅行・冒険","学習・スキル","キャリア・お金","健康・ライフスタイル","趣味・体験","精神・教養"];
    const STATUSES=["未着手","継続","達成"];
    const DEADLINES=["1か月以内","3か月以内","半年以内","1年以内","3年以内","5年以内","10年以内","未分類（未定）"];
    const LS_KEY="bucketlist.v2";

    function loadState(){return JSON.parse(localStorage.getItem(LS_KEY)||"{}");}
    function saveState(s){localStorage.setItem(LS_KEY, JSON.stringify(s));}

    const params=new URLSearchParams(location.search);
    const id=params.get("id");
    const from=params.get("from")||"index";

    const state=loadState();
    let target=null, genreKey=null;
    for(const g of GENRES){
      const found=state[g]?.find(it=>it.id===id);
      if(found){target=found;genreKey=g;break;}
    }
    if(!target){alert("対象が見つかりません");location.href="index.html";}

    // 初期表示
    document.getElementById("titleInput").value=target.title;
    const statusSel=document.getElementById("statusSelect");
    STATUSES.forEach(s=>{const o=document.createElement("option");o.value=s;o.textContent=s;if(s===target.status) o.selected=true;statusSel.appendChild(o)});
    const deadlineSel=document.getElementById("deadlineSelect");
    DEADLINES.forEach(d=>{const o=document.createElement("option");o.value=d;o.textContent=d;if(d===target.deadline) o.selected=true;deadlineSel.appendChild(o)});
    document.getElementById("noteArea").value=target.note||"";

    // 保存処理
    document.getElementById("saveBtn").onclick=()=>{
      target.title=document.getElementById("titleInput").value.trim();
      target.status=statusSel.value;
      target.deadline=deadlineSel.value;
      target.note=document.getElementById("noteArea").value;
      saveState(state);
      alert("保存しました");
    };

    // 戻る処理
    document.getElementById("backBtn").onclick=()=>{
      location.href= from==="status" ? "status.html" : "index.html";
    };
  </script>
</body>
</html>
