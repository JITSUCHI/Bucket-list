<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Bucket Listï¼ˆå…¨ã‚«ãƒ†ã‚´ãƒªãƒ»è‡ªå‹•é€£ç•ªï¼‰</title>
  <link rel="stylesheet" href="./style.css?v=23" />
  <style>
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;margin:8px 0 16px}
    .btn{border:1px solid #222;background:#fff;border-radius:6px;padding:6px 10px;cursor:pointer}
    .btn:hover{filter:brightness(0.98)}
    .row{display:flex;gap:8px;align-items:center;margin:10px 0 6px}
    .row input[type="text"]{flex:1;min-width:160px;padding:8px;border:1px solid #cbd5e1;border-radius:6px}
    .row select{padding:7px;border:1px solid #cbd5e1;border-radius:6px}
    .item-actions{display:inline-flex;gap:6px;margin-left:8px;opacity:.7}
    .item-actions button{border:1px solid #cbd5e1;background:#fff;border-radius:6px;padding:2px 6px;cursor:pointer}
    .item-actions button:hover{background:#f1f5f9}
    .editable[contenteditable="true"]{outline:2px dashed #60a5fa; outline-offset:2px; background:#eff6ff}
    .muted{color:#666; font-size:12px}
  </style>
</head>
<body>
  <div class="paper">
    <div class="sheet">
      <header class="sheet__header">
        <h1>My Bucket List</h1>
        <p class="legend">
          <span class="legend__red">èµ¤è‰²:é”æˆ</span>ã€
          <span class="legend__blue">é’è‰²:é€²æ—ã‚ã‚Š</span>ã€
          <span class="legend__green">ç·‘è‰²:ç¶™ç¶šä¸­</span>
        </p>
        <p class="updated" id="updated">ï¼ˆæœ€çµ‚æ›´æ–°æ—¥: â€”ï¼‰</p>
      </header>

      <div id="app"></div>

      <p class="muted">â€» ã“ã®ç‰ˆã¯ localStorage ã«ä¿å­˜ã—ã¾ã™ã€‚åˆ¥ç«¯æœ«ã§ã¯ JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚</p>
    </div>
  </div>

  <script>
  // ====== ãƒ‡ãƒ¼ã‚¿ ======
  const KEY = "bucketlist_v4";
  const initialData = {
    updatedAt: new Date().toISOString(),
    categories: [
      { id:"travel", title:"ğŸ—º æ—…è¡Œãƒ»å†’é™º", items:[
        { text:"å—æ¥µã«è¡Œã", status:"todo" },
        { text:"å°ç¬ åŸã§æ˜Ÿç©ºã‚­ãƒ£ãƒ³ãƒ—", status:"todo" },
        { text:"éŸ“å›½ã§ãƒãƒ¼ã‚«ãƒ¼ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã«å‚åŠ ã™ã‚‹", status:"todo" },
      ]},
      { id:"learn", title:"ğŸ“š å­¦ç¿’ãƒ»ã‚¹ã‚­ãƒ«", items:[
        { text:"Gæ¤œå®šã«åˆæ ¼ã™ã‚‹", status:"todo" },
        { text:"Eè³‡æ ¼ã«åˆæ ¼ã™ã‚‹", status:"todo" },
        { text:"AWSè³‡æ ¼ã‚’å–å¾—ã™ã‚‹", status:"todo" },
        { text:"Webã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã™ã‚‹", status:"todo" },
      ]},
      { id:"career", title:"ğŸ’¼ ã‚­ãƒ£ãƒªã‚¢ãƒ»ãŠé‡‘", items:[
        { text:"å€‹äººé–‹ç™ºã§æœˆâ—¯ä¸‡å††ã®åç›Šã‚’å¾—ã‚‹", status:"todo" },
        { text:"æŠ•è³‡ã§è³‡ç”£â—¯â—¯ä¸‡å††ã‚’ç¯‰ã", status:"todo" },
      ]},
      { id:"life", title:"ğŸƒ å¥åº·ãƒ»ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«", items:[
        { text:"ä½“é‡60kgã‚’é”æˆã™ã‚‹", status:"todo" },
        { text:"é€±2å›ã‚¸ãƒ ã«é€šã†", status:"todo" },
        { text:"ã‚­ãƒ£ãƒ³ãƒ—é£¯ã‚’è‡ªåˆ†ã§ä½œã‚‹", status:"todo" },
      ]},
      { id:"hobby", title:"ğŸ¨ è¶£å‘³ãƒ»ä½“é¨“", items:[
        { text:"Columbiaã®ã‚­ãƒ£ãƒ³ãƒ—ã‚¦ã‚§ã‚¢ã‚’æƒãˆã‚‹", status:"todo" },
        { text:"æ˜Ÿç©ºã®ä¸‹ã§ç„šãç«ã‚’ã™ã‚‹", status:"todo" },
        { text:"ãƒ€ãƒ³ãƒ€ãƒ€ãƒ³ã‚’å…¨å·»èª­ã‚€", status:"todo" },
      ]},
      { id:"mind", title:"ğŸŒ± ç²¾ç¥ãƒ»æ•™é¤Š", items:[
        { text:"ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½ã‚’ä½“ç³»çš„ã«å­¦ã¶", status:"todo" },
        { text:"ä¸€å†Šã«æ²¡é ­ã™ã‚‹èª­æ›¸æ™‚é–“ã‚’ä½œã‚‹", status:"todo" },
        { text:"â—‹â—‹ã®æ˜ ç”»ã‚’è¦³ã‚‹", status:"todo" },
      ]},
      { id:"log", title:"ğŸ“… é€²æ—ãƒ¡ãƒ¢", items:[
        { text:"2025-08-31ï¼šã‚µã‚¤ãƒˆåˆç‰ˆã‚’å…¬é–‹", status:"progress" }
      ]},
    ]
  };

  const statusClass = { done:"done red", progress:"blue", ongoing:"green", todo:"" };

  const load = ()=>JSON.parse(localStorage.getItem(KEY)||"null")||structuredClone(initialData);
  const save = (d)=>{d.updatedAt=new Date().toISOString();localStorage.setItem(KEY,JSON.stringify(d));
    document.getElementById("updated").textContent=`ï¼ˆæœ€çµ‚æ›´æ–°æ—¥: ${new Date(d.updatedAt).toLocaleString()}ï¼‰`;
  };

  let state = load();

  const el=(tag,attrs={},...chs)=>{
    const n=document.createElement(tag);
    for(const[k,v] of Object.entries(attrs)){
      if(k==="class") n.className=v;
      else if(k.startsWith("on")) n.addEventListener(k.slice(2),v);
      else n.setAttribute(k,v);
    }
    chs.forEach(c=>n.append(c instanceof Node?c:document.createTextNode(c)));
    return n;
  };

  // ====== Render ======
  function render(){
    const app=document.getElementById("app"); app.innerHTML="";
    let counter=1;

    state.categories.forEach(cat=>{
      const details=el("details",{class:"blk",open:true});
      details.append(el("summary",{},el("span",{},cat.title)));

      // è¿½åŠ UI
      const addRow = el("div",{class:"row"},
        el("input",{type:"text",placeholder:"é …ç›®ã‚’è¿½åŠ â€¦",id:`add-${cat.id}`}),
        el("select",{id:`sel-${cat.id}`},
          el("option",{value:"todo"},"æœª"),
          el("option",{value:"progress"},"é€²æ—"),
          el("option",{value:"ongoing"},"ç¶™ç¶š"),
          el("option",{value:"done"},"é”æˆ"),
        ),
        el("button",{class:"btn",onclick:()=>addItem(cat.id)},"è¿½åŠ ")
      );
      details.append(addRow);

      const ol=el("ol",{class:"items"});
      cat.items.forEach((item,idx)=>{
        ol.append(renderItem(cat.id,idx,item,counter));
        counter++;
      });
      details.append(ol);
      app.append(details);
    });
    save(state);
  }

  function renderItem(catId, idx, item, no){
    const li=el("li");
    const span=el("span",{class:`editable ${statusClass[item.status]||""}`,contenteditable:"false"});
    span.textContent=`${no}. ${item.text}`;

    const sel=el("select",{onchange:e=>{
      item.status=e.target.value;
      span.className=`editable ${statusClass[item.status]||""}`;
      save(state); render();
    }},
      el("option",{value:"todo",selected:item.status==="todo"},"æœª"),
      el("option",{value:"progress",selected:item.status==="progress"},"é€²æ—"),
      el("option",{value:"ongoing",selected:item.status==="ongoing"},"ç¶™ç¶š"),
      el("option",{value:"done",selected:item.status==="done"},"é”æˆ"),
    );

    const actions=el("span",{class:"item-actions"},
      el("button",{onclick:()=>{
        const ed=span.getAttribute("contenteditable")==="true";
        if(ed){span.setAttribute("contenteditable","false"); item.text=span.textContent.replace(/^\d+\.\s*/,"").trim(); save(state);}
        else{span.setAttribute("contenteditable","true");span.focus();}
      }},"âœ"),
      el("button",{onclick:()=>moveItem(catId,idx,-1)},"â†‘"),
      el("button",{onclick:()=>moveItem(catId,idx,1)},"â†“"),
      el("button",{onclick:()=>deleteItem(catId,idx)},"ğŸ—‘"),
    );

    li.append(span," ",sel,actions);
    return li;
  }

  // ====== æ“ä½œ ======
  function addItem(catId){
    const input=document.getElementById(`add-${catId}`);
    const sel=document.getElementById(`sel-${catId}`);
    const text=(input.value||"").trim();
    if(!text) return;
    const cat=state.categories.find(c=>c.id===catId);
    cat.items.push({text,status:sel.value});
    input.value="";
    render();
  }

  function deleteItem(catId,idx){
    const cat=state.categories.find(c=>c.id===catId);
    cat.items.splice(idx,1); render();
  }
  function moveItem(catId,idx,d){
    const cat=state.categories.find(c=>c.id===catId);
    const j=idx+d; if(j<0||j>=cat.items.length)return;
    const [it]=cat.items.splice(idx,1); cat.items.splice(j,0,it); render();
  }

  render();
  </script>
</body>
</html>
